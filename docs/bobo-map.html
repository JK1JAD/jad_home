<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JAD 全国ボボマップ（SVGインタラクティブ）</title>
  <style>
    :root{
      --ink:#0b132b;
      --acc:#2a9d8f;
      --mut:#94a3b8;
      --c-beccho:#60a5fa;
      --c-mara:#34d399;
      --c-bobo:#f472b6;
      --c-hojin:#fb923c;
      --c-common:#d1d5db;
      --card:#111827;
      --ring:#22d3ee;
    }
    html,body{background:var(--ink);color:#e5e7eb;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:32px 16px}
    h1{margin:4px 0 12px;font-size:clamp(22px,3.6vw,34px);line-height:1.2}
    .lead{color:var(--mut);margin-bottom:20px}
    .panel{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:16px}
    .grid{display:grid;grid-template-columns:1fr 280px;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .mapbox{position:relative;min-height:520px;display:grid;place-items:center}
    .mapbox svg{max-width:100%;height:auto}
    .cat-beccho path.prefecture{fill:var(--c-beccho)}
    .cat-mara    path.prefecture{fill:var(--c-mara)}
    .cat-bobo    path.prefecture{fill:var(--c-bobo)}
    .cat-hojin   path.prefecture{fill:var(--c-hojin)}
    .cat-common  path.prefecture{fill:var(--c-common)}
    .mapbox .stroke { fill:none; stroke:#0f172a; stroke-width:.8; opacity:.7 }
    .mapbox .prefecture{stroke:#0f172a;stroke-width:.6;cursor:pointer;transition:transform .1s ease, filter .1s ease}
    .mapbox .prefecture:hover{filter:brightness(1.06)}
    .mapbox .prefecture:focus{outline:none;filter:brightness(1.08) drop-shadow(0 0 0.8rem rgba(34,211,238,.25))}
    .legend{display:grid;gap:8px}
    .legend .card{background:#0f172a;border-radius:12px;padding:12px}
    .legend h3{margin:0 0 8px;font-size:16px;color:#e2e8f0}
    .legend ul{list-style:none;margin:0;padding:0;display:grid;gap:6px}
    .legend li{display:grid;grid-template-columns:16px 1fr;gap:10px;align-items:center;font-size:14px;color:#cbd5e1}
    .swatch{width:16px;height:16px;border-radius:4px;box-shadow:0 0 0 1px rgba(0,0,0,.25) inset}
    .s-beccho{background:var(--c-beccho)}
    .s-mara{background:var(--c-mara)}
    .s-bobo{background:var(--c-bobo)}
    .s-hojin{background:var(--c-hojin)}
    .s-common{background:var(--c-common)}
    .note{color:var(--mut);font-size:12px;margin-top:10px}
    .tip{position:absolute;pointer-events:none;background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px;font-size:13px;line-height:1.4;box-shadow:0 10px 30px rgba(0,0,0,.35);transform:translate(-50%,-120%);min-width:160px}
    .tip b{color:#fff}
    footer{margin-top:20px;color:var(--mut);font-size:12px}
    a{color:#8be9d8}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#0b132b;border:1px solid #0ea5a5;color:#c7fffb;border-radius:8px;padding:2px 6px;font-size:12px}
  </style>
</head>
<body>
<!-- ▼▼ 地図セクション：これ丸ごと貼り替え ▼▼ -->
<section class="map-section" style="max-width:980px;margin:24px auto;">
  <!-- 地図が入る箱（必須） -->
  <div id="mapbox"
       style="background:#0b132b;border-radius:12px;padding:12px;min-height:420px;"></div>

  <!-- 一時テスト：必ず見えるかの確認用。表示できたらこの <img> は消してOK -->
  
</section>

<!-- 真っ黒対策（強制上書き） -->
<style>
  #mapbox svg{width:100%;height:auto;display:block;}
  #mapbox svg path,#mapbox svg polygon,#mapbox svg rect{
    fill:#f4d03f !important;          /* 明るい黄 */
    stroke:#0f172a !important;        /* 濃い線 */
    stroke-width:.6 !important;
    vector-effect:non-scaling-stroke;
  }
</style>

<script>
<!-- 地図が入る箱 -->
<div id="mapbox"
     style="max-width:980px;margin:24px auto;background:#0b132b;border-radius:12px;padding:12px;min-height:420px;">
  <span id="probe" style="color:#9ca3af">loading…</span>

</div>

<style>
  /* 真っ黒対策（強制上書き） */
  #mapbox svg{width:100%;height:auto;display:block;}
  #mapbox svg path,#mapbox svg polygon,#mapbox svg rect{
    fill:#f4d03f !important; stroke:#0f172a !important; stroke-width:.6 !important;
    vector-effect:non-scaling-stroke;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const box = document.getElementById('mapbox');
  const probe = document.getElementById('probe');
  if (probe) probe.textContent = 'JS alive ✅';   // ← JSが走ってるか目印

  const url = '../images/japan.svg';              // ← 位置はコレで正解
  try {
    const res = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const svgText = await res.text();

    const parser = new DOMParser();
    const doc = parser.parseFromString(svgText, 'image/svg+xml');
    const svg = doc.documentElement;

    svg.removeAttribute('display');
    svg.removeAttribute('visibility');
    svg.style.display = 'block';
    svg.style.background = 'transparent';

    box.innerHTML = '';          // probeを消す
    box.appendChild(svg);        // ← ここで#mapboxに地図を突入
  } catch (e) {
    box.innerHTML = `<p style="color:#fca5a5">地図の読み込みに失敗: ${e.message}</p>`;
    // フォールバック（最終手段）
    const obj = document.createElement('object');
    obj.type = 'image/svg+xml';
    obj.data = url;
    obj.style.width = '100%';
    obj.style.display = 'block';
    box.appendChild(obj);
  }
});
</script>

<!-- ▲▲ ここまで ▲▲ -->


  <div class="wrap">
    <h1>JAD 全国ボボマップ <small style="font-size:.6em;color:var(--mut)">（SVGインタラクティブ）</small></h1>
    <p class="lead">都道府県ごとに、代表的な俗称・方言の“系統”を色分け。マウスオーバーで県名と語を表示します。<br>※ 初期データは仮配置です。<span class="kbd">dialectMap</span> を編集して即反映できます。</p>
    <div class="panel grid">
      <div class="mapbox" id="mapbox">
        <div id="tooltip" class="tip" style="display:none"></div>
      </div>
      <aside class="legend">
        <div class="card">
          <h3>凡例（系統）</h3>
          <ul>
            <li><span class="swatch s-beccho"></span><span>べっちょ系（東北〜北海道など）</span></li>
            <li><span class="swatch s-mara"></span><span>まら系（主に関西・中部の一部）</span></li>
            <li><span class="swatch s-bobo"></span><span>ぼぼ系（中国・四国・九州の一部）</span></li>
            <li><span class="swatch s-hojin"></span><span>ほーじん系（沖縄方言）</span></li>
            <li><span class="swatch s-common"></span><span>共通/混在（ちんちん・まんこ 等）</span></li>
          </ul>
        </div>
      </aside>
    </div>
    <footer>監修：JAD（JK1JAD）</footer>
  </div>
  <script>
    const dialectMap = {1:{cat:'beccho', term:'べっちょ（女）/ まら（男）'},2:{cat:'beccho', term:'べっちょ（女）'},47:{cat:'hojin', term:'ほーじん（男）/ ほーじら（女）'}};
    const prefNames = {1:'北海道',2:'青森',47:'沖縄'};
    async function loadSVG(){
      const box=document.getElementById('mapbox');
      try{
        const res = await fetch('../images/japan.svg');
        if(!res.ok) throw new Error('SVGが見つかりません。');
        const svgText=await res.text();
        const parser=new DOMParser();
        const doc=parser.parseFromString(svgText,'image/svg+xml');
        const svg=doc.documentElement;
        svg.setAttribute('role','img');
        svg.setAttribute('aria-label','日本地図');
        const candidates=svg.querySelectorAll('[id],[data-code],path,g');
        candidates.forEach(el=>{
          const id=el.getAttribute('id')||'';
          const dataCode=el.getAttribute('data-code')||'';
          let code=null;let isPref=false;
          let m=id.match(/pref-(\d{2})/);
          if(m){code=parseInt(m[1],10);isPref=true;}
          else if(/^\d{1,2}$/.test(id)){code=parseInt(id,10);isPref=true;}
          else if(dataCode){code=parseInt(dataCode,10);isPref=true;}
          if(!isPref && id.startsWith('JP')&&id.length>=4){code=parseInt(id.slice(2,4),10);isPref=true;}
          if(isPref && code>=1 && code<=47){
            el.classList.add('prefecture');
            const map=dialectMap[code]||{cat:'common',term:'（未設定）'};
            el.classList.add('cat-'+map.cat);
            el.setAttribute('data-code',String(code).padStart(2,'0'));
            el.setAttribute('data-name',prefNames[code]||'');
            el.setAttribute('data-term',map.term||'');
            el.addEventListener('mousemove',onHover);
            el.addEventListener('mouseenter',onEnter);
            el.addEventListener('mouseleave',onLeave);
          }
        });
        box.prepend(svg);
      }catch(err){box.innerHTML='<div style="color:#fca5a5">'+err.message+'</div>';}
    }
    const tip=document.getElementById('tooltip');
    function onEnter(e){const el=e.currentTarget;const r=el.getBoundingClientRect();showTip(e.pageX||(r.left+r.width/2+window.scrollX),e.pageY||(r.top+window.scrollY),el);}
    function onHover(e){showTip(e.pageX,e.pageY,e.currentTarget);}
    function onLeave(){tip.style.display='none';}
    function showTip(x,y,el){const name=el.getAttribute('data-name')||'県名不明';const term=el.getAttribute('data-term')||'（未設定）';tip.innerHTML='<b>'+name+'</b><br>'+term;tip.style.left=x+'px';tip.style.top=y+'px';tip.style.display='block';}
    loadSVG();
  </script>
document.addEventListener('DOMContentLoaded', async () => {
  const probe = document.getElementById('probe');
  if (probe) probe.textContent = 'JS alive ✅';
  // …fetch('../images/japan.svg') 以降…
});

</body>
</html>

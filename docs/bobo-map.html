<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ぼぼマップ | JK1JAD</title>
<style>
  /* ===== JAD風・最低限 ===== */
  :root{ --ink:#0b132b; --mut:#94a3b8; --y:#d6c420; }
  html,body{ margin:0; background:var(--ink); color:#e5e7eb; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  .wrap{ max-width:1024px; margin:0 auto; padding:24px 16px 40px; }
  h1{ font-size:1.4rem; margin:0 0 .25rem; }
  .lead{ color:var(--mut); margin:0 0 1rem; font-size:.95rem; }
  .stage{ background:#0f172a; border:1px solid #1f2937; border-radius:16px; padding:12px; }
  .stage svg{ width:100%; height:auto; display:block; }
  .pill{ display:inline-block; font-size:.78rem; color:#9ca3af; border:1px solid #334155; padding:.1rem .5rem; border-radius:999px; margin:.5rem 0 1rem; }
  .note{ color:#9ca3af; font-size:.85rem; margin-top:.75rem; }

  /* ===== 地図の見た目（県パス） ===== */
  /* 県パス（data-code が付くもの）をベース色で塗る。 */
  .stage svg path[data-code]{ fill:var(--y) !important; stroke:#0b132b; stroke-width:1.5; vector-effect:non-scaling-stroke; }
  /* 枠線や区切り線は塗らない（太線グループ想定） */
  .stage svg g[stroke-width="2"] > path{ fill:none !important; }
  /* ホバー時の簡易ハイライト */
  .stage svg path[data-code].hovered{ filter:brightness(1.1); stroke-width:2.2; }

  /* モバイル余白 */
  @media (max-width:480px){ .wrap{ padding:18px 12px 28px; } }
</style>
</head>
<body>
  <div class="wrap">
    <h1>全国ぼぼマップ（仮置き版）</h1>
    <p class="lead">「展示しておく」ことが目的の軽量版。細かい作り込みは後日QSY予定です。</p>
    <span class="pill">置場っ子ちゃんの片隅コーナー</span>

<!-- ぼぼマップ（インライン描画版） -->
<div id="stage" class="stage" aria-busy="true" aria-live="polite"></div>

<!-- クリック情報カード -->
<div id="bobo-info" style="display:none;"></div>


    <p class="note">※ 県パス（<code>path[data-code]</code>）へツールチップ（県名）を自動付与。ホバーでちょい強調。</p>
  </div>
<script>
(function(){
  // ====== 県データ：名前・面積・総人口（概数） ======
  const PREFS = {
"01":["北海道",83424,5200000],"02":["青森",9645,1240000],"03":["岩手",15275,1220000],
"04":["秋田",11638,960000],"05":["宮城",7285,2300000],"06":["山形",9323,1080000],
"07":["福島",13784,1840000],"08":["茨城",6097,2910000],"09":["栃木",6408,1930000],
"10":["群馬",6362,1930000],"11":["埼玉",3798,7340000],"12":["千葉",5157,6270000],
"13":["東京",2194,13960000],"14":["神奈川",2416,9230000],"15":["新潟",12584,2220000],
"16":["富山",4247,1040000],"17":["石川",4186,1140000],"18":["福井",4190,767000],
"19":["山梨",4465,817000],"20":["長野",13562,2050000],
"21":["岐阜",10621,1990000],"22":["静岡",7777,3630000],"23":["愛知",5173,7550000],
"24":["三重",5774,1790000],
"25":["滋賀",4017,1410000],"26":["京都",4612,2560000],"27":["大阪",1905,8820000],
"28":["兵庫",8401,5460000],"29":["奈良",3691,1330000],"30":["和歌山",4726,924000],
"31":["鳥取",3507,553000],"32":["島根",6708,674000],"33":["岡山",7114,1890000],
"34":["広島",8479,2790000],"35":["山口",6112,1350000],
"36":["徳島",4146,727000],"37":["香川",1877,956000],"38":["愛媛",5676,1340000],
"39":["高知",7103,698000],
"40":["福岡",4986,5110000],"41":["佐賀",2441,814000],"42":["長崎",4132,1310000],
"43":["熊本",7409,1750000],"44":["大分",6339,1130000],"45":["宮崎",7735,1070000],
"46":["鹿児島",9187,1590000],"47":["沖縄",2281,1460000]
  };

  // 総人口→（男/女）万人に丸めて表示（目安：男49%/女51%）
  const toMan = n => Math.round(n / 10000).toLocaleString();
  function splitSex(pop){
    const male = Math.round(pop * 0.49);
    const female = Math.round(pop * 0.51);
    return { maleMan: toMan(male), femaleMan: toMan(female) };
  }

  // ぼぼネタ（ホバー3秒後に吹き出し）
  function boboLine(name){
    const lines = [
      `${name}は今日も“だいたいOK（ぼぼ）”運転中。`,
      `ここは${name}、地図の精度も気持ちも“ほぼ”で行こう。`,
      `${name}チェック…Sメーター59−（ぼぼ）。`,
      `${name}：詳細は次回公演で。今回は展示（ぼぼ）。`
    ];
    return lines[Math.floor(Math.random()*lines.length)];
  }

  // 下部情報カード（県名＋面積＋人口（男/女））
  const info = document.getElementById('bobo-info');
  info.style.cssText = "position:sticky;bottom:0;max-width:1024px;margin:12px auto;padding:12px 14px;background:#0b132b;border:1px solid #334155;border-radius:12px;color:#e5e7eb;font:14px/1.6 system-ui,Segoe UI,Roboto;display:none";
 　info.innerHTML = `
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <strong id="pname"></strong>
    <button id="pclose"
      style="background:none;border:none;color:#94a3b8;font-size:16px;cursor:pointer;line-height:1;">
      ×
    </button>
  </div>
  <div id="pmeta" style="color:#94a3b8;margin-top:.25rem"></div>
`;


  // 3秒後に出る吹き出し（マウスオーバー）
  const tip = document.createElement('div');
  tip.style.cssText = "position:absolute;z-index:9999;max-width:260px;padding:8px 10px;border-radius:10px;background:#111827;color:#e5e7eb;border:1px solid #334155;box-shadow:0 6px 18px rgba(0,0,0,.25);font:12px/1.5 system-ui,Segoe UI,Roboto;display:none;pointer-events:none";
  document.body.appendChild(tip);
  let hoverTimer = null;

  // SVGをインライン化してイベント付与
  const host = document.getElementById('stage');
  (async ()=>{
    try{
      const res = await fetch('images/japan.svg', {cache:'no-store'});
      if(!res.ok) throw new Error('SVG fetch failed: '+res.status);
      host.innerHTML = await res.text();

      const svg = host.querySelector('svg');
      if(!svg) throw new Error('SVG root not found');
      if(!svg.hasAttribute('viewBox')){
        const w = svg.getAttribute('width') || 600;
        const h = svg.getAttribute('height') || 800;
        svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
        svg.removeAttribute('width'); svg.removeAttribute('height');
      }
      svg.setAttribute('preserveAspectRatio','xMidYMid meet');

      // 見た目と県名ラベル（中央）
      const style = document.createElementNS('http://www.w3.org/2000/svg','style');
      style.textContent = `[data-code]{fill:#d6c420;stroke:#333;stroke-width:1}
                           [data-code].hovered{filter:brightness(1.1);stroke-width:2}
                           text.label{font-size:10px;fill:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}`;
      svg.prepend(style);

      svg.querySelectorAll('[data-code]').forEach(el=>{
        const code = (el.getAttribute('data-code')||'').padStart(2,'0');
        const rec = PREFS[code];
        const name = rec ? rec[0] : `不明(${code})`;

        // ラベル（rectの中央）
        if(el.tagName === 'rect'){
          const cx = +el.getAttribute('x') + (+el.getAttribute('width'))/2;
          const cy = +el.getAttribute('y') + (+el.getAttribute('height'))/2;
          const textEl = document.createElementNS('http://www.w3.org/2000/svg','text');
          textEl.setAttribute('x', cx);
          textEl.setAttribute('y', cy);
          textEl.setAttribute('class','label');
          textEl.textContent = name;
          svg.appendChild(textEl);
        }

        // 標準ツールチップ（保険）
        const old = el.querySelector('title'); if(old) old.remove();
        const t = document.createElementNS('http://www.w3.org/2000/svg','title');
        t.textContent = name;
        el.appendChild(t);

        // ホバー：3秒後にボボネタ吹き出し
        el.addEventListener('mouseenter', (ev)=>{
          el.classList.add('hovered');
          clearTimeout(hoverTimer);
          hoverTimer = setTimeout(()=>{
            const rect = el.getBoundingClientRect();
            const line = boboLine(name);
            tip.textContent = line;
            tip.style.left = (window.scrollX + rect.left + rect.width/2 - Math.min(240, tip.offsetWidth||200)/2) + 'px';
            tip.style.top  = (window.scrollY + rect.top - 12 - 10) + 'px'; // 要素の少し上
            tip.style.display = 'block';
          }, 3000);
        });
        el.addEventListener('mouseleave', ()=>{
          el.classList.remove('hovered');
          clearTimeout(hoverTimer);
          tip.style.display = 'none';
        });

        // クリック：県名・面積・人口（男◯万人 女◯万人）
        el.addEventListener('click', ()=>{
          if(!rec) return;
          const [nm, area, pop] = rec;
          const {maleMan, femaleMan} = splitSex(pop);
          document.getElementById('pname').textContent = nm;
          document.getElementById('pmeta').textContent =
            `面積 ${area.toLocaleString()} km² / 人口 男 ${maleMan} 万人・女 ${femaleMan} 万人（概数）`;
          info.style.display = 'block';
          info.scrollIntoView({behavior:'smooth', block:'nearest'});
        });
     　　document.getElementById('pclose').onclick = ()=>{
  info.style.display = 'none';
};

      });

      host.setAttribute('aria-busy','false');
    }catch(err){
      host.innerHTML = '<div style="padding:12px;color:#fca5a5">読み込みエラー：'+String(err)+'</div>';
      host.setAttribute('aria-busy','false');
    }
  })();
})();
</script>

</body>
</html>
